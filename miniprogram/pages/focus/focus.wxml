<!--pages/focus/focus.wxml-->
<view class="light-main">
    <!-- 外层圆形容器 -->
    <view class="light-in center" style="width: 70%; max-width: 300px; aspect-ratio: 1/1; border-radius: 50%; margin-top: 10%; position: relative;">
        <!-- 内层圆形 -->
        <view class="light-out center" style="background-color:#ecf0f3; width: 72%; aspect-ratio: 1/1; border-radius: 50%">
            <!-- 计时器文字 -->
            <text class="counter" style="font-size: min(12vw, 40px);">{{currentTime.main}}</text>
            <text style="font-size: min(8vw, 25px); color: #333333;">:{{currentTime.seconds}}</text>
        </view>

        <!-- 圆形轨道容器 -->
        <view class="track center" style="width: 100%; height: 100%; position: absolute;">
            <!-- Canvas 进度条 -->
            <canvas type="2d" id="progressCanvas" style="width: 100%; height: 100%; position: absolute;"></canvas>
            <!-- 可拖拽按钮 -->
            <view class="progress-btn" style="width: 30px; height: 30px; border-radius: 50%; position: absolute; transform: translate(-50%, -50%); left: {{buttonPosition.left}}px; top: {{buttonPosition.top}}px;" bind:touchmove="onDragPgb">
            </view>
        </view>
    </view>

    <!-- 下面一部分控件按钮 -->
    <view class="button-box" style="width: 80%; height: 45%; margin: auto;">
        <!-- 滑动控件 -->
        <view class="light-in slider-box center" style="height: min(30%, 70px); border-radius: 15px;">
            <movable-area style="width: 95%; height:80%; width: {{slider_width}};">
                <movable-view id="slider" direction="horizontal" style="z-index: 100; width: 18%; height: 100%;" bind:touchend="onSliderEnd" bindchange="onSliderChange" x="{{slider_x}}">
                    <image src="../../resources/light-icons/slider.png" style="width: 50%; height: 50%;"></image>
                </movable-view>
            </movable-area>
            <text class="slider-tips"> >>>向右滑动开始专注 </text>
        </view>

        <!-- 第一排按钮 -->
        <view class="btn-line-1" style="height: 30%; margin-top: 5%;">
            <button class="wide-btn light-out" style="background-color: #ff6347; margin-right: 14px; flex: 1;">
                <image src="../../resources/light-icons/user-icon.png" style="width: 24px; height: 24px; "></image>
                <text style="color: #ffffff;">个人专注</text>
            </button>
            <button hover-class="onBtnPushed" class="wide-btn light-out" style="flex: 1;" bind:tap="waitingUpdate">
                <image src="../../resources/light-icons/group-icon.png" style="width: 24px; height: 24px;"></image>
                <text>组队专注</text>
            </button>
        </view>

        <!-- 第二排按钮 -->
        <view class="btn-line-2" style="height: 40%;">
            <button hover-class="onBtnPushed" class="long-btn light-out" style="flex: 1;" bind:tap="showBzy">
                <image src="../../resources/light-icons/bzy.png" style="width: 30px; height: 30px;"></image>
                <text>白噪音</text>
            </button>
            <button hover-class="onBtnPushed" class="long-btn light-out" style="margin: 0 7%; flex: 1;" bind:tap="waitingUpdate">
                <image src="../../resources/light-icons/pmxz.png" style="width: 30px; height: 30px;"></image>
                <text>横屏</text>
            </button>
            <button hover-class="onBtnPushed" class="long-btn light-out" style="flex: 1;" bind:tap="goToRanklist">
                <image src="../../resources/light-icons/phb.png" style="width: 30px; height: 30px;"></image>
                <text>排行榜</text>
            </button>
        </view>

        <!-- 白噪音弹层 -->
        <van-popup show="{{show_bzy}}" bind:close="closeBzy" closeable="true" round="true" custom-style="width: 75%;    height: 65%;">
            <ciew class="sound-box" style="width: 100%; height: 100%;">
                <text style="font-size: 20px; margin-top: 20px;">白噪音播放器</text>
                <grid-view class="sound-bkg" cross-axis-count="3" main-axis-gap="15px" cross-axis-gap="15px">
                    <view wx:for="{{soundItems}}" wx:key="index" class="{{item.checked ? 'sound-switch-checked' : 'sound-switch'}} light-out center" style="flex-direction: column;" bindtap="handleSoundSwitch" data-index="{{index}}">
                        <view class="cpx-icon" style="height: 50%; width: 50%;">
                            <image style="width: 100%; height: 100%;" src="{{item.icon}}"></image>
                        </view>
                        <view class="ckd-icon" style="height: 50%; width: 50%;">
                            <image style="width: 100%; height: 100%;" src="{{item.checkedIcon}}"></image>
                        </view>
                        <text style="font-size: 2vw; margin-top: 5%;">{{item.name}}</text>
                    </view>
                </grid-view>
                <view class="sound-ctrl" style="display: flex; align-items: center;">
                    <!-- 播放/暂停按钮 -->
                    <view class="center {{isPlaying ? 'sound-switch-checked' : 'sound-switch'}}" style="margin-right: 5%; height: 80%; aspect-ratio: 1/1; border-radius: 50%; background-color: #ff6347;" bind:tap="switchPlayState">
                        <image class="ckd-icon" src="../../resources/light-icons/pause.png" style="width: 40%; height: 40%;"></image>
                        <image class="cpx-icon" src="../../resources/light-icons/play.png" style="width: 35%; height: 40%; margin-left: 5%;"></image>
                    </view>
                    <!-- 音量滑动条轨道 -->
                    <view class="light-out volume-slider" style="height: 80%; min-width: 170px; margin: auto; background-color: #ecf0f3; border-radius: 12px; display: flex; align-items: center;" bind:tap="waitingUpdate">
                        <!-- 音量图标 -->
                        <view style="position: absolute; width: 8%; aspect-ratio: 1/1;  margin-left: 5%;">
                            <image src="../../resources/light-icons/music.png" style="width: 100%; height: 100%; "></image>
                        </view>
                        <!-- 滑动条（绑定触摸事件） -->
                        <view class="volume-slider" style="width: 120px; height: 100%; background: #FFB3A6; border-radius: 12px;">
                        </view>
                    </view>
                </view>
            </ciew>
        </van-popup>
    </view>
</view>